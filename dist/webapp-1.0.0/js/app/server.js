var http=require("http"),fs=require("fs"),resstr="",reqstr="",reqdata={},resdata=function(){return id="",name="",author="",current=0,total=0,value="",{id:id,name:name,author:author,total:total,current:current,value:value}}(),server=http.createServer(function(t,e){var r=[];t.on("data",function(t){r.push(t)}),t.on("end",function(){reqstr=Buffer.concat(r).toString(),console.log("Request data:"+reqstr),reqdata=JSON.parse(reqstr);var t="../../resource/text/",a=fs.readFileSync(t+reqdata.id+"/"+reqdata.current+".txt","utf-8"),s=JSON.parse(fs.readFileSync(t+reqdata.id+"/config.json"));resdata.id=s.id,resdata.name=s.name,resdata.author=s.author,resdata.total=s.total,resdata.current=reqdata.current,resdata.value=a,resstr=JSON.stringify(resdata),e.writeHead(200,{"Content-Type":"text/plain",charset:"utf-8","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"PUT,POST,GET,DELETE,OPTIONS"}),e.write(resstr),e.end(),console.log("response data:"+resstr)})});server.listen(80,function(){console.log("开始监听...")});