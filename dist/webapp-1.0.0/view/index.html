<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<!--bootstrap启用移动优先，禁用缩放-->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

	<script src="../plugins/jquery/jquery-1.10.2.min.js"></script>
	<script src="../plugins/bootstrap/js/bootstrap.min.js"></script>
	<script src="../plugins/swiper/js/swiper.jquery.min.js"></script>
	<link rel="stylesheet" href="../plugins/swiper/css/swiper.min.css">
	<style>
		body,
		html {
			width: 100%;
			height: 100%;
		}
		
		.parallax-bg {
			width: 130%;
			height: 100%;
			position: absolute;
			left: 0;
			top: 0;
		}
		
		.swiper-container {
			width: 100%;
			height: 100%;
		}
		
		.container-fluid {
			width: 100%;
			height: 100%;
		}
		
		.custom-img {
			width: 100%;
		}
	</style>

	<script type="text/javascript">
        var _current=0;
        var COOKIENUM=2;
        var _content=(function(){
            current=0;            
            total=0;
            url="";
            end=false;
            return {               
                total:total,
                current:current,
                url:url,
                end:end

            }
        })();
        function getContent(current,domid){
            var responsedata={};
            _content.end=false;
            $.ajax({
                cache: true,
                type: "GET",
                url:'../server/ajaxResp.php?current='+current,
                async: true,
                processData: false,  // 告诉jQuery不要去处理发送的数据
                contentType: false,   // 告诉jQuery不要去设置Content-Type请求头
                error: function(request) {
                    //alert("error"+request);
                    console.log(request);
                },
                success: function(data) {                    
                    for(var n in data){
                        _content[n] = data[n];
                    }
                    _content.end=true;                                     
                    $("#"+domid).attr("src",_content.url);
                },
                dataType: "json"
            });
            
        }

        window.onload = function() {
            
            var mySwiper = new Swiper ('.swiper-container', {
                autoHeight: true, 
                onInit:function(swiper){
                    //设置最开始的3个slider
                    _current++;
                    getContent(_current,"img-1");
                    getContent(_current+1,"img-2");
                    getContent(_current+2,"img-3");
                    
                },
                onSlidePrevStart: function(swiper){
                    //向上一页滑动，activeIndex是上一页的
                   var _current=parseInt(mySwiper.slides[swiper.activeIndex+1].id.split("-")[1]);
                   
                    if(_current-(COOKIENUM+1)>0){
                        if($("#slider-"+(_current-(COOKIENUM+1))).length>0){return;}
                        mySwiper.prependSlide('<div class="swiper-slide" id="slider-'+(_current-(COOKIENUM+1))+'"><img class="custom-img" id="img-'+(_current-(COOKIENUM+1))+'"></div>');
                        getContent(_current-(COOKIENUM+1),"img-"+(_current-(COOKIENUM+1)));
                    }
                   // alert(_current);
                    console.log("pre:"+_current);
                },
                onSlideNextStart: function(swiper){
                    // alert('next;');

                    //向下一页划动，activeIndex是下一页的
                    var _current=parseInt(mySwiper.slides[swiper.activeIndex-1].id.split("-")[1]);
                    if(_current<_content.total-COOKIENUM){
                        //预加载当前页之后第COOKIENUM+1页，当前页的下一页将是“当前页”，保持时刻在“当前页”之后有COOKINUM页被缓存
                        if($("#slider-"+(_current+(COOKIENUM+1))).length>0){return;}
                        mySwiper.appendSlide('<div class="swiper-slide" id="slider-'+(_current+(COOKIENUM+1))+'"><img class="custom-img" id="img-'+(_current+(COOKIENUM+1))+'"></div>');
                        getContent(_current+(COOKIENUM+1),"img-"+(_current+(COOKIENUM+1)));
                    }
                    
                    console.log("next:"+_current);                    
                },
                onSlideNextEnd: function(swiper){
                    var _current=parseInt(mySwiper.slides[swiper.activeIndex].id.split("-")[1]);
                    //alert(_current);
                   
                },
                onClick: function(swiper){
                    
                },
                
            });
            
        };

</script>

</head>

<body>
	<div class="container-fluid">
		<div class="swiper-container">
			<div class="swiper-wrapper">

				<div class="swiper-slide" id="slider-1">
					<img src="" id="img-1" class="custom-img" alt="">
				</div>
				<div class="swiper-slide" class="custom-img" id="slider-2">
					<img src="" id="img-2" alt="">
				</div>
				<div class="swiper-slide" class="custom-img" id="slider-3">
					<img src="" id="img-3" alt="">
				</div>
			</div>
		</div>
	</div>


</body>

</html>